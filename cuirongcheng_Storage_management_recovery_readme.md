# Storage_management_recovery

## 项目介绍
分区管理是应用较广泛的一种存储管理技术。本项目用一种结构化高级语言构造分区描述器，编制动态分区分配算法和回收算法模拟程序，并讨论不同分配算法的特点。
1、编写：First Fit Algorithm     
2、编写：Best Fit Algorithm 
3、编写：空闲区回收算法

## 软件架构
Visual Studio 2010

## 使用说明

### **1.预备知识** 


 **(1)查阅相关资料；** 

参考《计算机操作系统》（第三版）、《计算机操作系统》（第四版）两本教材复习掌握优先数调度算法程序、循环轮转调度算法程序的基本原理和实现。

优最先适应法分配：要求自由链按起始地址递增的次序排列，一旦找到大于或等于所要求内存长度的分区， 则结束探索。

最佳适应法分配：要求从小到大的次序组成空闲区自由链，当用户作业或进程申请一个空闲区时，存储管理程序从表头开始查找，当找到第一个满足要求的空闲区时，停止查找。

回收：当用户作业或进程执行结束时，存储管理程序要收回已使用完毕的空闲区，并将其插入空闲区可用表或自由链。在将回收的空闲区插入可用表或自由链时和分配空闲区时一样，也要碰到剩余空闲区拼接问题，存在4种关系：

该空闲区的上下两相邻分区都是空闲区；

该空闲区的上相邻区是空闲区；

该空闲区的下相邻区是空闲区；

两相邻区都不是空闲区。

 **(2)初步编写程序；** 

 1、定义分区描述器 node，包括 3个元素：     
（1）adr——分区首地址     
（2）size——分区大小     
（3）next——指向下一个分区的指针 
    
2、定义 3个指向 node 结构的指针变量：    
（1）head1——空闲区队列首指针     
（2）back1——指向释放区 node 结构的指针     
（3）assign——指向申请的内存分区 node 结构的指针  
  
3、定义 1个整形变量：          
free——用户申请存储区的大小（由用户键入）。

 **(3)准备测试数据；** 

 **(4)修改程序代码。** 

### **2.上机调试** 

### **3.主要流程和源代码** 

 **(1)主程序** 

1、定义分区描述器 node，包括 3个元素：     
（1）adr——分区首地址     
（2）size——分区大小     
（3）next——指向下一个分区的指针   
  
2、定义 3个指向 node 结构的指针变量：     
（1）head1——空闲区队列首指针     
（2）back1——指向释放区 node 结构的指针     
（3）assign——指向申请的内存分区 node 结构的指针   
  
3、定义 1个整形变量：          
free——用户申请存储区的大小（由用户键入）   
 
 **(2)过程** 

1、定义 check 过程，用于检查指定的释放块（由用户键入）的合法性     
2、定义 assignment1 过程，实现 First Fit Algorithm     
3、定义 assignment2 过程，实现 Best Fit Algorithm     
4、定义 acceptment1 过程，实现 First Fit Algorithm 的回收算法     
5、定义 acceptment2 过程，实现 Best Fit Algorithm 的回收算法     
6、定义 print 过程，打印空闲区队列  
  
 **(3)执行** 

程序首先申请一整块空闲区，其首址为 0，大小为 32767；然后，提示用户使用哪种分 配算法，再提示是分配还是回收；分配时要求输入申请区的大小，回收时要求输入释放区的首址和大小。 

分配过程：用户输入需要申请的块的大小，选择空闲链中第一个不小于申请块大小的空闲块，若该空闲块大小等于申请块大小，则直接从空闲链中删除该空闲块，将该申请块插入分配链；若该空闲块大小大于申请块大小，则从空闲块中截取一部分，将剩余部分插入空闲链，将分配部分插入分配链。

回收过程：用户输入需要释放的存储区的首地址和大小，系统遍历已分配链表，判断输入是否合法，若不合法重新输入；若合法，从已分配链表中删除该节点，将该节点的首地址和空闲链的每个节点的尾地址比较，判断是否需要前拼接；将该节点的尾地址和空闲链的每个节点的首地址比较，判断是否需要后拼接，拼接完成后插入。  
 
 **(4)输出**    
   
要求每执行一次，输出一次空闲区队列情况，内容包括：                
编号  首址  终址  大小     

注：输出空闲区队列的排序，应符合所用分配算法的要求。

 **(5)数据结构** 

```
typedef struct node
{
	int id;					//分区编号    
	int adr;				//分区首地址   
	int size;				//分区大小   
	struct node *prior;		//指向前一个分区的指针
	struct node *next;		//指向下一个分区的指针
};
```

 **(6)全局变量** 

```
node *headFree=NULL;		//空闲区链表首指针
node *headDtb=NULL;			//分配区链表首指针
node *tailDtb=NULL;         //分配区链表尾指针

node *back=NULL;			//指向释放区 node 结构的指针

int Free=0;					//用户申请存储区的大小（由用户键入）
int backFirstAdr=0;			//释放区首地址（由用户键入）
int backSize=0;				//释放区大小（由用户键入）

node INIT;
```

 **(7)函数** 

```
//初始化设置函数
void init()	

//分配算法的参数输入函数
int input_Assignment()	

//回收算法的参数输入函数
void input_Acceptment(int &firstAdr,int &size)

//检查释放块合法性函数
void check(node *head,int a,int b)

//结果打印函数
void print(node *head)

//分配链表尾插入节点函数
void inserttailDtb(node *head)

//双向链表的删除函数
void deleteFromDuLinkList(node *&Head,node *head)

//前插法插入函数
void insertToDuLinkList(node *Head,node *head)

//首地址递增插入函数
void insertToDuLinkList1(node *Head,node *head)

//块大小递增插入函数
void insertToDuLinkList2(node *Head,node *head)

//检查链表拼接节点函数
void beforeAcceptmentCheck(node *head,node *&before,node *&after)

//最先适应法分配函数
int FirstFitAlgorithm_Assignment(node *head)

//最先适应法回收函数
void FirstFitAlgorithm_Acceptment()

//最佳适应法分配函数
int BestFitAlgorithm_Assignment(node *head)

//最佳适应法回收函数
void BestFitAlgorithm_Acceptment()

//主菜单
void menu()

//主函数
int main()
```

###  **4.遇到的主要问题和解决方法** 

 **(1)程序整体结构问题** 

考虑到顺序插入和前后搜索，程序整体结构采用双向链表，通过next或者prio属性取得前一个或者后一个；

本模拟程序采用两条链，一条分配链，一条空闲链，将分配回收操作转换为两条链之间的移动问题。

 **(2)头尾节点的操作问题** 

当头尾节点发生变化时，及时将头的prio置为空，将尾的next置为空，否则容易出现错误。

 **(3)内存回收拼接问题** 

分为三种情况：向前拼接，向后拼接，前后拼接

解决方案：将需要回收的节点的首地址和空闲链表的每个节点的尾地址进行比较，若存在，用指针记录；

将需要回收的节点的尾地址和空闲链表的每个节点的首地址进行比较，若存在，用指针记录；根据两个指针的返回情况，判断拼接类型，或者不拼接直接插入。

 **(4)空闲区块插入问题** 

最先适应法：根据存储块的首地址大小进行插入；

最佳适应法：根据存储块的大小进行插入；

解决方案：向某个节点前插入某个节点单独写成一个函数，两种排序方案分别调用。

 # 良心友情链接

[腾讯QQ群快速检索](http://u.720life.cn/s/8cf73f7c)

[软件免费开发论坛](http://u.720life.cn/s/bbb01dc0)